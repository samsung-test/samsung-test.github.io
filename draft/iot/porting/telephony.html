<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="icon"  href="/favicon.ico" />
<title>Telephony</title>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<base id="baseURL" href="/draft/" />
<meta id="docsVersion" content="draft" />
<meta name="last-modified" content="2019-09-29 01:12:36 +0530" />
<meta http-equiv="cache-control" content="max-age=24" />
<meta http-equiv="cache-control" content="no-cache" />
<meta http-equiv="Cache-Control" content="no-store" />
<meta http-equiv="pragma" content="no-cache" />
<meta http-equiv="Expires" content="600" />

<link rel="stylesheet" href="/vendor/bootstrap/css/bootstrap.min.css">
<link rel="stylesheet" href="/css/carousel.css?v=29092019">
<link rel="stylesheet" href="/css/custom.css?v=29092019">
<link rel="stylesheet" href="/css/responsive.css?v=29092019">
<link rel="stylesheet" href="/css/main.css?v=29092019">

</head>
<body>
    <div class="scroller">
        <div class="navbar-wrapper">
    <nav class="navbar navbar-default navbar-static-top navbar-fixed-top">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand active open" href="/">
                    <span class="brand-tizen"><img src="/images/logo.png" alt="logo"></span>
                    <span class="brand-docs">Docs</span>
                </a>
            </div>

            <ul id="navbar" class="nav navbar-nav navbar-right navbar-collapse collapse">
                <!--li><a href="what-is-tizen/overview/tizen">What is Tizen</a></li-->
                <li><a href="platform/about/tizen-open-source-overview">Platform</a></li>
                <li><a href="application/">Application</a></li>
                <li><a href="iot/">IoT</a></li>
                <!--li><a href="https://developer.tizen.org" target="_blank">Application</a></li-->
                <li><a href="https://developer.tizen.org/development/tizen-studio/download" target="_blank">Download</a>
                </li>
                <li class="navbar-divisor"></li>
                <li class="search">
                    <a id="gnb_search_btn" href="#">
                        <div class="search-btn"></div>
                    </a>
                    <form method="GET" id="gnb_search_box" class="searchbox" action="/search.php" name="searchbox">
                        <input class="form-control" type="text" name="q" placeholder="Search ..." required="true">
                        <a href="#" onclick="if (document.forms['searchbox'].q.value !== '') 
                                                $(this).closest('form').submit()
                                                else
                                                    document.getElementById('gnb_search_box').addEventListener('click', function(event){
                                                    event.preventDefault()
                                                });
                                                "><img src="/images/ic_search_ac.png"></a>
                    </form>
                </li>
                <li>
                    <div id="widgetVersionSwitcher"></div>
                </li>

            </ul>
        </div>
    </nav>
</div>
        <div class="landing-tizen">
            <div class="container">
                <div class="row">
                    


<ul class="nav side-menu">
    
</ul>
<script>
    $("a[href$='/iot/porting/telephony.html']").addClass("sidebar-link-selected");
</script>
                    <div class="body" id="printableArea">
                        <div class="widgetLatestVersionNotification"></div>
                        <h1 id="telephony">Telephony</h1>

<p>This guide describes the Telephony architecture in detail, including the various telephony components and the workflow in the Telephony framework. It also provides porting guidelines for vendors to facilitate OAL interface development for their hardware.</p>

<p>The Tizen Telephony features include:</p>
<ul>
  <li>Telecommunication functionalities, such as call, SS, SMS, SIM, network, and packet service</li>
  <li>Plug-in architecture</li>
</ul>

<p>To understand the telephony implementation, you must be familiar with the following definitions:</p>

<ul>
  <li>Core object
    <ul>
      <li>Bundle of functions and supporting database information which processes requests, responses, and notifications designated to a specific module, such as call, SS, SIM, and network.</li>
      <li>Core objects form the executable component of a Telephony module (call, SS, SIM, network)</li>
    </ul>
  </li>
  <li>Hardware Abstraction Layer (HAL)
    <ul>
      <li>The HAL ensures that similar functionality is provided by various hardware (modems) from the same modem vendor.</li>
      <li>All hardware-specific changes are controlled and processed by HALs.</li>
      <li>Depending on the modem chipset, a modem driver can be required.</li>
    </ul>
  </li>
  <li>Hooks
    <ul>
      <li>Hooks provide a mechanism to tap the requests, responses, and notifications of other Telephony modules.</li>
      <li>Hooking is a transparent mechanism and does not affect the normal processing of requests, responses, and notifications.</li>
    </ul>
  </li>
</ul>

<h2 id="tizen-telephony-architecture">Tizen Telephony Architecture</h2>

<p>Tizen Telephony supports plugin architecture, which provides the flexibility to include various predefined plugins in the system with little modification.</p>

<p><strong>Figure: Telephony architecture</strong></p>

<p><img src="media/telephony-arch.png" alt="Telephony architecture" /></p>

<p>The 3 major components of Tizen Telephony are the libraries, plugins, and server.</p>

<h2 id="telephony-libraries">Telephony Libraries</h2>

<p>There are 2 main telephony libraries:</p>

<ul>
  <li>
    <p>Telephony API (TAPI) library</p>

    <p>The TAPI library (or simply TAPI) is a standardized interface, provided as the <code class="highlighter-rouge">libtapi</code> package, for applications to interact with Tizen Telephony. TAPI executes in the application’s context, and it provides synchronous and asynchronous APIs. The following figure shows the <code class="highlighter-rouge">libtapi</code> components.</p>

    <p><strong>Figure: libtapi components</strong></p>

    <p><img src="media/libtapi.png" alt="libtapi components" /></p>

    <p>Applications can interface to telephony features, such as call, SMS, and network, through the respective module APIs exposed in the <code class="highlighter-rouge">libtapi</code> library. Telephony also provides an additional library, <code class="highlighter-rouge">capi-telephony</code>, for third-party applications.</p>
  </li>
  <li>
    <p>Core Telephony library</p>

    <p>The Core Telephony library, provided as the <code class="highlighter-rouge">libtcore</code> package, provides an API framework to interwork with Tizen Telephony. The following figure shows the <code class="highlighter-rouge">libtcore</code> components.</p>

    <p><strong>Figure: libtcore components</strong></p>

    <p><img src="media/telephony03.png" alt="libtcore components" /></p>

    <p>With <code class="highlighter-rouge">libtcore</code>, you can:</p>

    <ul>
      <li>Create, destroy, and maintain various server components, such as the server, communicators, HALs, core objects, and plugins.</li>
      <li>Maintain storage, queue mechanism, and general utilities.</li>
      <li>Support CMUX (creation/destruction/processing).</li>
      <li>Parse AT.</li>
    </ul>
  </li>
</ul>

<h2 id="telephony-plugins">Telephony Plugins</h2>

<p>There are 4 kinds of plugins:</p>

<ul>
  <li><strong>Communicator plugins</strong> interface TAPI and the telephony server. For example, the DBUS communicator (<code class="highlighter-rouge">DBUS_TAPI</code>) is provided by default.</li>
  <li><strong>Modem plugins</strong> are core functional units providing the telephony functionality. They maintain and manage the telephony states and related databases.</li>
  <li><strong>Modem interface plugins</strong> interface the telephony server to the communication processor. They are hardware-specific plugins which define hardware capabilities and usage. Modem interface plugins are also called HALs.</li>
  <li><strong>Free style plugins</strong> provide functionality independent of communication processor hardware. Examples of free style plugins are packetservice, storage, and indicator.</li>
</ul>

<p>The following figure provides an overview of the Telephony plugin types.</p>

<p><strong>Figure: Telephony plugins</strong></p>

<p><img src="media/telephony08.png" alt="Telephony plugins" /></p>

<h2 id="telephony-server">Telephony Server</h2>

<p>Tizen Telephony runs as a Telephony server daemon, <code class="highlighter-rouge">telephony-daemon</code>.</p>

<p>The Telephony server executes as a <code class="highlighter-rouge">g-main</code> loop from the <code class="highlighter-rouge">glib</code> library.</p>

<p><strong>Figure: Telephony server</strong></p>

<p><img src="media/telephony09.png" alt="Telephony server" /></p>

<h2 id="porting-the-oal-interface">Porting the OAL Interface</h2>

<p>OEM vendors can port available plugins within Telephony as needed to support specific hardware. It is not mandatory that all plugins are ported.</p>

<p>This section provides guidance to OEM vendors to develop various Telephony plugins.</p>

<h3 id="plugin-descriptor">Plugin Descriptor</h3>

<p>Each telephony plugin must provide a descriptor structure:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">tcore_plugin_define_desc</span> <span class="p">{</span>
    <span class="cm">/* Name of the plugin */</span>
    <span class="n">gchar</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>

    <span class="cm">/* Initializing priority of the plugin */</span>
    <span class="k">enum</span> <span class="n">tcore_plugin_priority</span> <span class="n">priority</span><span class="p">;</span>

    <span class="cm">/* Plugin version */</span>
    <span class="kt">int</span> <span class="n">version</span><span class="p">;</span>

    <span class="cm">/* Plugin 'load' function reference */</span>
    <span class="n">gboolean</span><span class="p">(</span><span class="o">*</span><span class="n">load</span><span class="p">)();</span>

    <span class="cm">/* Plugin 'init' function reference */</span>
    <span class="n">gboolean</span><span class="p">(</span><span class="o">*</span><span class="n">init</span><span class="p">)(</span><span class="n">TcorePlugin</span> <span class="o">*</span><span class="p">);</span>

    <span class="cm">/* Plugin 'unload' function reference */</span>
    <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">unload</span><span class="p">)(</span><span class="n">TcorePlugin</span> <span class="o">*</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div></div>

<p>The plugin descriptor structure must be named as <code class="highlighter-rouge">plugin_define_desc</code>. The server obtains the address of this symbol to give control to the plugin to execute its defined functionality.</p>

<p>The initialization order among various Telephony plugins is based on each plugin’s priority.</p>

<p>OEMs need to specifically implement the modem and modem interface plugins to support their hardware.</p>

<h3 id="call-service-operations">Call Service Operations</h3>

<p>To provide call services, the following functions must be implemented:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">tcore_call_operations</span> <span class="p">{</span>
    <span class="cm">/* Call 'dial' function reference */</span>
    <span class="n">TReturn</span> <span class="p">(</span><span class="o">*</span><span class="n">dial</span><span class="p">)(</span><span class="n">CoreObject</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span> <span class="n">UserRequest</span> <span class="o">*</span><span class="n">ur</span><span class="p">);</span>

    <span class="cm">/* Call 'answer' function reference */</span>
    <span class="n">TReturn</span> <span class="p">(</span><span class="o">*</span><span class="n">answer</span><span class="p">)(</span><span class="n">CoreObject</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span> <span class="n">UserRequest</span> <span class="o">*</span><span class="n">ur</span><span class="p">);</span>

    <span class="cm">/* Call 'end' function reference */</span>
    <span class="n">TReturn</span> <span class="p">(</span><span class="o">*</span><span class="n">end</span><span class="p">)(</span><span class="n">CoreObject</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span> <span class="n">UserRequest</span> <span class="o">*</span><span class="n">ur</span><span class="p">);</span>

    <span class="cm">/* Call 'hold' function reference */</span>
    <span class="n">TReturn</span> <span class="p">(</span><span class="o">*</span><span class="n">hold</span><span class="p">)(</span><span class="n">CoreObject</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span> <span class="n">UserRequest</span> <span class="o">*</span><span class="n">ur</span><span class="p">);</span>

    <span class="cm">/* Call 'active' function reference */</span>
    <span class="n">TReturn</span> <span class="p">(</span><span class="o">*</span><span class="n">active</span><span class="p">)(</span><span class="n">CoreObject</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span> <span class="n">UserRequest</span> <span class="o">*</span><span class="n">ur</span><span class="p">);</span>

    <span class="cm">/* Call 'swap' function reference */</span>
    <span class="n">TReturn</span> <span class="p">(</span><span class="o">*</span><span class="n">swap</span><span class="p">)(</span><span class="n">CoreObject</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span> <span class="n">UserRequest</span> <span class="o">*</span><span class="n">ur</span><span class="p">);</span>

    <span class="cm">/* Call 'join' function reference */</span>
    <span class="n">TReturn</span> <span class="p">(</span><span class="o">*</span><span class="n">join</span><span class="p">)(</span><span class="n">CoreObject</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span> <span class="n">UserRequest</span> <span class="o">*</span><span class="n">ur</span><span class="p">);</span>

    <span class="cm">/* Call 'split' function reference */</span>
    <span class="n">TReturn</span> <span class="p">(</span><span class="o">*</span><span class="n">split</span><span class="p">)(</span><span class="n">CoreObject</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span> <span class="n">UserRequest</span> <span class="o">*</span><span class="n">ur</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="sms-service-operations">SMS Service Operations</h3>

<p>To provide SMS services, the following functions must be implemented:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">tcore_sms_operations</span> <span class="p">{</span>
    <span class="cm">/* For UMTS, SMS 'send' function reference */</span>
    <span class="n">TReturn</span> <span class="p">(</span><span class="o">*</span><span class="n">send_umts_msg</span><span class="p">)(</span><span class="n">CoreObject</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span> <span class="n">UserRequest</span> <span class="o">*</span><span class="n">ur</span><span class="p">);</span>

    <span class="cm">/* For CDMA, SMS 'read' function reference */</span>
    <span class="n">TReturn</span> <span class="p">(</span><span class="o">*</span><span class="n">send_cdma_msg</span><span class="p">)(</span><span class="n">CoreObject</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span> <span class="n">UserRequest</span> <span class="o">*</span><span class="n">ur</span><span class="p">);</span>

    <span class="cm">/* SMS 'read' function reference */</span>
    <span class="n">TReturn</span> <span class="p">(</span><span class="o">*</span><span class="n">read_msg</span><span class="p">)(</span><span class="n">CoreObject</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span> <span class="n">UserRequest</span> <span class="o">*</span><span class="n">ur</span><span class="p">);</span>

    <span class="cm">/* SMS 'save' function reference */</span>
    <span class="n">TReturn</span> <span class="p">(</span><span class="o">*</span><span class="n">save_msg</span><span class="p">)(</span><span class="n">CoreObject</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span> <span class="n">UserRequest</span> <span class="o">*</span><span class="n">ur</span><span class="p">);</span>

    <span class="cm">/* SMS 'delete' function reference */</span>
    <span class="n">TReturn</span> <span class="p">(</span><span class="o">*</span><span class="n">delete_msg</span><span class="p">)(</span><span class="n">CoreObject</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span> <span class="n">UserRequest</span> <span class="o">*</span><span class="n">ur</span><span class="p">);</span>

    <span class="cm">/* SMS 'get sca' function reference */</span>
    <span class="n">TReturn</span> <span class="p">(</span><span class="o">*</span><span class="n">get_sca</span><span class="p">)(</span><span class="n">CoreObject</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span> <span class="n">UserRequest</span> <span class="o">*</span><span class="n">ur</span><span class="p">);</span>

    <span class="cm">/* SMS 'set sca' function reference */</span>
    <span class="n">TReturn</span> <span class="p">(</span><span class="o">*</span><span class="n">set_sca</span><span class="p">)(</span><span class="n">CoreObject</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span> <span class="n">UserRequest</span> <span class="o">*</span><span class="n">ur</span><span class="p">);</span>

    <span class="cm">/* SMS 'get sms params' function reference */</span>
    <span class="n">TReturn</span> <span class="p">(</span><span class="o">*</span><span class="n">get_sms_params</span><span class="p">)(</span><span class="n">CoreObject</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span> <span class="n">UserRequest</span> <span class="o">*</span><span class="n">ur</span><span class="p">);</span>

    <span class="cm">/* SMS 'set sms params' function reference */</span>
    <span class="n">TReturn</span> <span class="p">(</span><span class="o">*</span><span class="n">set_sms_params</span><span class="p">)(</span><span class="n">CoreObject</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span> <span class="n">UserRequest</span> <span class="o">*</span><span class="n">ur</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="network-service-operations">Network Service Operations</h3>

<p>To provide network services, the following functions must be implemented:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">tcore_network_operations</span> <span class="p">{</span>
    <span class="cm">/* Network 'search' function reference */</span>
    <span class="n">TReturn</span> <span class="p">(</span><span class="o">*</span><span class="n">search</span><span class="p">)(</span><span class="n">CoreObject</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span> <span class="n">UserRequest</span> <span class="o">*</span><span class="n">ur</span><span class="p">);</span>

    <span class="cm">/* Network 'set plmn selection mode' function reference */</span>
    <span class="n">TReturn</span> <span class="p">(</span><span class="o">*</span><span class="n">set_plmn_selection_mode</span><span class="p">)(</span><span class="n">CoreObject</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span> <span class="n">UserRequest</span> <span class="o">*</span><span class="n">ur</span><span class="p">);</span>

    <span class="cm">/* Network 'get plmn selection mode'' function reference */</span>
    <span class="n">TReturn</span> <span class="p">(</span><span class="o">*</span><span class="n">get_plmn_selection_mode</span><span class="p">)(</span><span class="n">CoreObject</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span> <span class="n">UserRequest</span> <span class="o">*</span><span class="n">ur</span><span class="p">);</span>

    <span class="cm">/* Network 'set service domain' function reference */</span>
    <span class="n">TReturn</span> <span class="p">(</span><span class="o">*</span><span class="n">set_service_domain</span><span class="p">)(</span><span class="n">CoreObject</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span> <span class="n">UserRequest</span> <span class="o">*</span><span class="n">ur</span><span class="p">);</span>

    <span class="cm">/* Network 'get service domain' function reference */</span>
    <span class="n">TReturn</span> <span class="p">(</span><span class="o">*</span><span class="n">get_service_domain</span><span class="p">)(</span><span class="n">CoreObject</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span> <span class="n">UserRequest</span> <span class="o">*</span><span class="n">ur</span><span class="p">);</span>

    <span class="cm">/* Network 'set band' function reference */</span>
    <span class="n">TReturn</span> <span class="p">(</span><span class="o">*</span><span class="n">set_band</span><span class="p">)(</span><span class="n">CoreObject</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span> <span class="n">UserRequest</span> <span class="o">*</span><span class="n">ur</span><span class="p">);</span>

    <span class="cm">/* Network 'get band' function reference */</span>
    <span class="n">TReturn</span> <span class="p">(</span><span class="o">*</span><span class="n">get_band</span><span class="p">)(</span><span class="n">CoreObject</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span> <span class="n">UserRequest</span> <span class="o">*</span><span class="n">ur</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="hal-operations">HAL Operations</h3>

<p>To provide HAL operations, the following functions must be implemented:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">tcore_hal_operations</span> <span class="p">{</span>
    <span class="cm">/* HAL 'power' function reference */</span>
    <span class="n">TReturn</span> <span class="p">(</span><span class="o">*</span><span class="n">power</span><span class="p">)(</span><span class="n">TcoreHal</span> <span class="o">*</span><span class="n">hal</span><span class="p">,</span> <span class="n">gboolean</span> <span class="n">flag</span><span class="p">);</span>

    <span class="cm">/* HAL 'send' function reference */</span>
    <span class="n">TReturn</span> <span class="p">(</span><span class="o">*</span><span class="n">send</span><span class="p">)(</span><span class="n">TcoreHal</span> <span class="o">*</span><span class="n">hal</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">data_len</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">);</span>

    <span class="cm">/* Network 'set up network interface' function reference */</span>
    <span class="n">TReturn</span> <span class="p">(</span><span class="o">*</span><span class="n">setup_netif</span><span class="p">)(</span><span class="n">CoreObject</span> <span class="o">*</span><span class="n">co</span><span class="p">,</span>
                           <span class="n">TcoreHalSetupNetifCallback</span> <span class="n">func</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">user_data</span><span class="p">,</span>
                           <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cid</span><span class="p">,</span> <span class="n">gboolean</span> <span class="n">enable</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div></div>

<p>For sample implementations of the modem and modem interface plugins, see <a href="#sample-modem-interface-plugin-implementation">Sample Modem Interface Plugin Implementation</a>.</p>

<h2 id="configuration">Configuration</h2>

<p>Telephony plugins must be installed in the following folders:</p>

<ul>
  <li>Modem plugins: <code class="highlighter-rouge">%{_libdir}/telephony/plugins/modems/</code></li>
  <li>Other plugins: <code class="highlighter-rouge">%{_libdir}/telephony/plugins/</code></li>
</ul>

<h2 id="references">References</h2>

<p>Tizen source site: <a href="http://review.tizen.org/git/">http://review.tizen.org/git/</a></p>

<p>Telephony packages:</p>
<ul>
  <li>Telephony daemon</li>
  <li>Telephony core library</li>
  <li>TAPI</li>
  <li>Telephony API for a third party application</li>
  <li>Communicator (DBUS_TAPI)</li>
  <li>Free style plugin (indicator)</li>
  <li>Free style plugin (packetservice)</li>
  <li>Free style plugin (nitz)</li>
  <li>Free style plugin (Database)</li>
  <li>Free style plugin (VCONF)</li>
  <li>Modem plugin (device)</li>
  <li>Modem interface plugin (device)</li>
  <li>Modem plugin (emulator)</li>
  <li>Modem interface plugin (emulator)</li>
</ul>

<h2 id="sample-modem-interface-plugin-implementation">Sample Modem Interface Plugin Implementation</h2>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/* HAL Operations */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">tcore_hal_operations</span> <span class="n">hal_ops</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">.</span><span class="n">power</span> <span class="o">=</span> <span class="n">hal_power</span><span class="p">,</span>
    <span class="p">.</span><span class="n">send</span> <span class="o">=</span> <span class="n">hal_send</span><span class="p">,</span>
    <span class="p">.</span><span class="n">setup_netif</span> <span class="o">=</span> <span class="n">hal_setup_netif</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span>
<span class="n">gboolean</span> <span class="nf">on_load</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">dbg</span><span class="p">(</span><span class="s">" Load!!!"</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span>
<span class="n">gboolean</span> <span class="nf">on_init</span><span class="p">(</span><span class="n">TcorePlugin</span> <span class="o">*</span><span class="n">plugin</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">TcoreHal</span> <span class="o">*</span><span class="n">hal</span><span class="p">;</span>
    <span class="n">PluginData</span> <span class="o">*</span><span class="n">user_data</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">custom_data</span> <span class="o">*</span><span class="n">data</span><span class="p">;</span>

    <span class="n">dbg</span><span class="p">(</span><span class="s">" Init!!!"</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">plugin</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">err</span><span class="p">(</span><span class="s">" PLug-in is NULL"</span><span class="p">);</span>

        <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/* User data for Modem Interface plugin */</span>
    <span class="n">user_data</span> <span class="o">=</span> <span class="n">g_try_new0</span><span class="p">(</span><span class="n">PluginData</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">user_data</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">err</span><span class="p">(</span><span class="s">" Failed to allocate memory for Plugin data"</span><span class="p">);</span>

        <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/* Register to server */</span>
    <span class="n">user_data</span><span class="o">-&gt;</span><span class="n">modem</span> <span class="o">=</span> <span class="n">tcore_server_register_modem</span><span class="p">(</span><span class="n">tcore_plugin_ref_server</span><span class="p">(</span><span class="n">plugin</span><span class="p">),</span> <span class="n">plugin</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">user_data</span><span class="o">-&gt;</span><span class="n">modem</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">err</span><span class="p">(</span><span class="s">" Registration Failed"</span><span class="p">);</span>
        <span class="n">g_free</span><span class="p">(</span><span class="n">user_data</span><span class="p">);</span>

        <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">dbg</span><span class="p">(</span><span class="s">" Registered from Server"</span><span class="p">);</span>


    <span class="n">data</span> <span class="o">=</span> <span class="n">g_try_new0</span><span class="p">(</span><span class="k">struct</span> <span class="n">custom_data</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">data</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">err</span><span class="p">(</span><span class="s">" Failed to allocate memory for Custom data"</span><span class="p">);</span>

        <span class="cm">/* Unregister from server */</span>
        <span class="n">tcore_server_unregister_modem</span><span class="p">(</span><span class="n">tcore_plugin_ref_server</span><span class="p">(</span><span class="n">plugin</span><span class="p">),</span> <span class="n">user_data</span><span class="o">-&gt;</span><span class="n">modem</span><span class="p">);</span>

        <span class="cm">/* Free plugin data */</span>
        <span class="n">g_free</span><span class="p">(</span><span class="n">user_data</span><span class="p">);</span>

        <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/* Open DPRAM device */</span>
    <span class="n">data</span><span class="o">-&gt;</span><span class="n">vdpram_fd</span> <span class="o">=</span> <span class="n">vdpram_open</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">vdpram_fd</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="cm">/* Free custom data */</span>
        <span class="n">g_free</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>

        <span class="cm">/* Unregister from server */</span>
        <span class="n">tcore_server_unregister_modem</span><span class="p">(</span><span class="n">tcore_plugin_ref_server</span><span class="p">(</span><span class="n">plugin</span><span class="p">),</span> <span class="n">user_data</span><span class="o">-&gt;</span><span class="n">modem</span><span class="p">);</span>

        <span class="cm">/* Free plugin data */</span>
        <span class="n">g_free</span><span class="p">(</span><span class="n">user_data</span><span class="p">);</span>

        <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="cm">/* Create and initialize HAL */</span>
    <span class="n">hal</span> <span class="o">=</span> <span class="n">tcore_hal_new</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="s">"vmodem"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hal_ops</span><span class="p">,</span> <span class="n">TCORE_HAL_MODE_AT</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">hal</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="cm">/* Close VDPRAM device */</span>
        <span class="n">vdpram_close</span><span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">vdpram_fd</span><span class="p">);</span>

        <span class="cm">/* Free custom data */</span>
        <span class="n">g_free</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>

        <span class="cm">/* Unregister from server */</span>
        <span class="n">tcore_server_unregister_modem</span><span class="p">(</span><span class="n">tcore_plugin_ref_server</span><span class="p">(</span><span class="n">plugin</span><span class="p">),</span> <span class="n">user_data</span><span class="o">-&gt;</span><span class="n">modem</span><span class="p">);</span>

        <span class="cm">/* Free Plugin data */</span>
        <span class="n">g_free</span><span class="p">(</span><span class="n">user_data</span><span class="p">);</span>

        <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">user_data</span><span class="o">-&gt;</span><span class="n">hal</span> <span class="o">=</span> <span class="n">hal</span><span class="p">;</span>

    <span class="cm">/* Link custom data to HAL user data */</span>
    <span class="n">tcore_hal_link_user_data</span><span class="p">(</span><span class="n">hal</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>

    <span class="cm">/* Set HAL as Modem Interface plugin's user data */</span>
    <span class="n">tcore_plugin_link_user_data</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="n">user_data</span><span class="p">);</span>

    <span class="cm">/* Register to Watch list */</span>
    <span class="n">data</span><span class="o">-&gt;</span><span class="n">watch_id_vdpram</span> <span class="o">=</span> <span class="n">__register_gio_watch</span><span class="p">(</span><span class="n">hal</span><span class="p">,</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">vdpram_fd</span><span class="p">,</span> <span class="n">on_recv_vdpram_message</span><span class="p">);</span>
    <span class="n">dbg</span><span class="p">(</span><span class="s">" fd: [%d] Watch ID: [%d]"</span><span class="p">,</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">vdpram_fd</span><span class="p">,</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">watch_id_vdpram</span><span class="p">);</span>

    <span class="cm">/* Power ON VDPRAM device */</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">_modem_power</span><span class="p">(</span><span class="n">hal</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">)</span> <span class="o">==</span> <span class="n">TCORE_RETURN_SUCCESS</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">dbg</span><span class="p">(</span><span class="s">" Power ON - [SUCCESS]"</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">err</span><span class="p">(</span><span class="s">" Power ON - [FAIL]"</span><span class="p">);</span>
        <span class="k">goto</span> <span class="n">EXIT</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/* Check CP Power ON */</span>
    <span class="n">g_timeout_add_full</span><span class="p">(</span><span class="n">G_PRIORITY_HIGH</span><span class="p">,</span> <span class="n">SERVER_INIT_WAIT_TIMEOUT</span><span class="p">,</span> <span class="n">__load_modem_plugin</span><span class="p">,</span> <span class="n">hal</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

    <span class="n">dbg</span><span class="p">(</span><span class="s">"[VMMODEM] Exit"</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>

<span class="nl">EXIT:</span>
    <span class="cm">/* Deregister from Watch list */</span>
    <span class="n">__deregister_gio_watch</span><span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">watch_id_vdpram</span><span class="p">);</span>

    <span class="cm">/* Free HAL */</span>
    <span class="n">tcore_hal_free</span><span class="p">(</span><span class="n">hal</span><span class="p">);</span>

    <span class="cm">/* Close VDPRAM device */</span>
    <span class="n">vdpram_close</span><span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">vdpram_fd</span><span class="p">);</span>

    <span class="cm">/* Free custom data */</span>
    <span class="n">g_free</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>

    <span class="cm">/* Unregister from Server */</span>
    <span class="n">tcore_server_unregister_modem</span><span class="p">(</span><span class="n">tcore_plugin_ref_server</span><span class="p">(</span><span class="n">plugin</span><span class="p">),</span> <span class="n">user_data</span><span class="o">-&gt;</span><span class="n">modem</span><span class="p">);</span>

    <span class="cm">/* Free plugin data */</span>
    <span class="n">g_free</span><span class="p">(</span><span class="n">user_data</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">on_unload</span><span class="p">(</span><span class="n">TcorePlugin</span> <span class="o">*</span><span class="n">plugin</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">TcoreHal</span> <span class="o">*</span><span class="n">hal</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">custom_data</span> <span class="o">*</span><span class="n">data</span><span class="p">;</span>
    <span class="n">PluginData</span> <span class="o">*</span><span class="n">user_data</span><span class="p">;</span>

    <span class="n">dbg</span><span class="p">(</span><span class="s">" Unload!!!"</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">plugin</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="n">user_data</span> <span class="o">=</span> <span class="n">tcore_plugin_ref_user_data</span><span class="p">(</span><span class="n">plugin</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">user_data</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="n">hal</span> <span class="o">=</span> <span class="n">user_data</span><span class="o">-&gt;</span><span class="n">hal</span><span class="p">;</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">tcore_hal_ref_user_data</span><span class="p">(</span><span class="n">hal</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">data</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="cm">/* Deregister from Watch list */</span>
    <span class="n">__deregister_gio_watch</span><span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">watch_id_vdpram</span><span class="p">);</span>
    <span class="n">dbg</span><span class="p">(</span><span class="s">" Deregistered Watch ID"</span><span class="p">);</span>

    <span class="cm">/* Free HAL */</span>
    <span class="n">tcore_hal_free</span><span class="p">(</span><span class="n">hal</span><span class="p">);</span>
    <span class="n">dbg</span><span class="p">(</span><span class="s">" Freed HAL"</span><span class="p">);</span>

    <span class="cm">/* Close VDPRAM device */</span>
    <span class="n">vdpram_close</span><span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">vdpram_fd</span><span class="p">);</span>
    <span class="n">dbg</span><span class="p">(</span><span class="s">" Closed VDPRAM device"</span><span class="p">);</span>

    <span class="cm">/* Free custom data */</span>
    <span class="n">g_free</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>

    <span class="n">tcore_server_unregister_modem</span><span class="p">(</span><span class="n">tcore_plugin_ref_server</span><span class="p">(</span><span class="n">plugin</span><span class="p">),</span> <span class="n">user_data</span><span class="o">-&gt;</span><span class="n">modem</span><span class="p">);</span>
    <span class="n">dbg</span><span class="p">(</span><span class="s">" Unregistered from Server"</span><span class="p">);</span>

    <span class="n">dbg</span><span class="p">(</span><span class="s">" Unloaded MODEM"</span><span class="p">);</span>
    <span class="n">g_free</span><span class="p">(</span><span class="n">user_data</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* VMODEM Descriptor Structure */</span>
<span class="n">EXPORT_API</span> <span class="k">struct</span> <span class="n">tcore_plugin_define_desc</span> <span class="n">plugin_define_desc</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">"VMODEM"</span><span class="p">,</span>
    <span class="p">.</span><span class="n">priority</span> <span class="o">=</span> <span class="n">TCORE_PLUGIN_PRIORITY_HIGH</span><span class="p">,</span>
    <span class="p">.</span><span class="n">version</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">.</span><span class="n">load</span> <span class="o">=</span> <span class="n">on_load</span><span class="p">,</span>
    <span class="p">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">on_init</span><span class="p">,</span>
    <span class="p">.</span><span class="n">unload</span> <span class="o">=</span> <span class="n">on_unload</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="sample-modem-plugin-implementation">Sample Modem Plugin Implementation</h3>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">static</span>
<span class="n">gboolean</span> <span class="nf">on_load</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">dbg</span><span class="p">(</span><span class="s">"LOAD!!!"</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span>
<span class="n">gboolean</span> <span class="nf">on_init</span><span class="p">(</span><span class="n">TcorePlugin</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">TcoreHal</span> <span class="o">*</span><span class="n">h</span><span class="p">;</span>

    <span class="n">dbg</span><span class="p">(</span><span class="s">"INIT!!!"</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">err</span><span class="p">(</span><span class="s">"Plug-in is NULL"</span><span class="p">);</span>

        <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">h</span> <span class="o">=</span> <span class="n">tcore_server_find_hal</span><span class="p">(</span><span class="n">tcore_plugin_ref_server</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="s">"vmodem"</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">h</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">err</span><span class="p">(</span><span class="s">"HAL is NULL"</span><span class="p">);</span>

        <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">tcore_hal_add_send_hook</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">on_hal_send</span><span class="p">,</span> <span class="n">p</span><span class="p">);</span>
    <span class="n">tcore_hal_add_recv_callback</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">on_hal_recv</span><span class="p">,</span> <span class="n">p</span><span class="p">);</span>

    <span class="cm">/* Initialize modules */</span>
    <span class="n">s_modem_init</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">h</span><span class="p">);</span>
    <span class="n">s_network_init</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">h</span><span class="p">);</span>
    <span class="n">s_sim_init</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">h</span><span class="p">);</span>
    <span class="n">s_ps_init</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">h</span><span class="p">);</span>
    <span class="n">s_call_init</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">h</span><span class="p">);</span>
    <span class="n">s_ss_init</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">h</span><span class="p">);</span>
    <span class="n">s_sms_init</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">h</span><span class="p">);</span>
    <span class="n">tcore_hal_set_power</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">);</span>

    <span class="cm">/* Send "CPAS" command to invoke POWER UP NOTI */</span>
    <span class="n">s_modem_send_poweron</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>

    <span class="n">dbg</span><span class="p">(</span><span class="s">"Init - Successful"</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">on_unload</span><span class="p">(</span><span class="n">TcorePlugin</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">TcoreHal</span> <span class="o">*</span><span class="n">h</span><span class="p">;</span>

    <span class="n">dbg</span><span class="p">(</span><span class="s">"UNLOAD!!!"</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">err</span><span class="p">(</span><span class="s">"Plug-in is NULL"</span><span class="p">);</span>

        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">h</span> <span class="o">=</span> <span class="n">tcore_server_find_hal</span><span class="p">(</span><span class="n">tcore_plugin_ref_server</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="s">"vmodem"</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">h</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">tcore_hal_remove_send_hook</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">on_hal_send</span><span class="p">);</span>
        <span class="n">tcore_hal_remove_recv_callback</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">on_hal_recv</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="cm">/* Deinitialize the modules */</span>
    <span class="n">s_modem_exit</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
    <span class="n">s_network_exit</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
    <span class="n">s_sim_exit</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
    <span class="n">s_ps_exit</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
    <span class="n">s_call_exit</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
    <span class="n">s_ss_exit</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
    <span class="n">s_sms_exit</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* ATMODEM plug-in descriptor */</span>
<span class="k">struct</span> <span class="n">tcore_plugin_define_desc</span> <span class="n">plugin_define_desc</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">"ATMODEM"</span><span class="p">,</span>
    <span class="p">.</span><span class="n">priority</span> <span class="o">=</span> <span class="n">TCORE_PLUGIN_PRIORITY_MID</span><span class="p">,</span>
    <span class="p">.</span><span class="n">version</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">.</span><span class="n">load</span> <span class="o">=</span> <span class="n">on_load</span><span class="p">,</span>
    <span class="p">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">on_init</span><span class="p">,</span>
    <span class="p">.</span><span class="n">unload</span> <span class="o">=</span> <span class="n">on_unload</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="workflow">Workflow</h3>

<ul>
  <li>Initialization sequence
    <ol>
      <li>
        <p>The server loads the modem interface plugin.</p>
      </li>
      <li>
        <p>The modem interface plugin registers to the server.</p>
      </li>
      <li>
        <p>The server enumerates the modem interface plugin.</p>
      </li>
      <li>
        <p>The physical HAL is created.</p>
      </li>
      <li>
        <p>The modem interface plugin queries the modem state.</p>
      </li>
      <li>
        <p>If the modem is online, the CMUX (internal) channels are established.</p>
      </li>
      <li>
        <p>A logical HAL is created for each CMUX channel and assigned to a core object type. These are updated to the mapping table.</p>
      </li>
      <li>
        <p>The physical HAL mode is changed to <code class="highlighter-rouge">TRANSPARENT</code>, which disables the queue.</p>
      </li>
      <li>
        <p>The modem interface plugin requests the server to load the modem plugin corresponding to its architecture.</p>
      </li>
      <li>
        <p>The server loads the modem plugin.</p>
      </li>
      <li>
        <p>The modem plugin initializes the sub-modules and creates the core objects, based on the core object types defined in the mapping table by the modem interface plugin.</p>
      </li>
      <li>
        <p>The modem plugin notifies the server of the <code class="highlighter-rouge">PLUGIN_ADDED</code> event.</p>
      </li>
      <li>
        <p>The modem notifies the communicator of the <code class="highlighter-rouge">PLUGIN_ADDED</code> event.</p>
      </li>
      <li>
        <p>The communicator creates interfaces for the sub-modules present, based on the core objects created.</p>
      </li>
    </ol>

    <p><strong>Figure: Initialization sequence</strong></p>

    <p><img src="media/telephony11.png" alt="Telephony11.png" /></p>
  </li>
  <li>Request processing sequence
    <ol>
      <li>
        <p>The application request is sent to the communicator through TAPI.</p>
      </li>
      <li>
        <p>The communicator creates a user request based on the incoming request.</p>
      </li>
      <li>
        <p>The user request is dispatched to the communicator.</p>
      </li>
      <li>
        <p>The communicator dispatches the user request to the server.</p>
      </li>
      <li>
        <p>The server finds the plugin based on the modem name.</p>
      </li>
      <li>
        <p>The server extracts the core object type from the plugin’s core objects list, based on the request command.</p>
      </li>
      <li>
        <p>The server dispatches the user request to the core object.</p>
      </li>
      <li>
        <p>The core object dispatches the user request to dispatch a function based on the request command.</p>
      </li>
      <li>
        <p>A pending request is formed, added to the queue, and sent to the logical HAL assigned to the core object.</p>
      </li>
      <li>
        <p>The logical HAL dispatches the request data to its dedicated CMUX channel.</p>
      </li>
      <li>
        <p>CMUX encodes the request data and dispatches it to the physical HAL.</p>
      </li>
      <li>
        <p>The physical HAL sends the request data to the modem.</p>
      </li>
    </ol>

    <p><strong>Figure: Request processing sequence</strong></p>

    <p><img src="media/telephony11.png" alt="Request processing sequence" /></p>
  </li>
  <li>Response processing sequence
    <ol>
      <li>
        <p>The modem sends response data to the physical HAL.</p>
      </li>
      <li>
        <p>The physical HAL dispatches the response data to CMUX.</p>
      </li>
      <li>
        <p>CMUX decodes the received response data and dispatches it to the corresponding logical HAL, based on the CMUX channel.</p>
      </li>
      <li>
        <p>The logical HAL dispatches the decoded response data to the corresponding core object.</p>
      </li>
      <li>
        <p>The core object processes the received response data and extracts the user request from the pending queue. It sends the response data corresponding to the user request.</p>
      </li>
      <li>
        <p>The user request extracts the communicator.</p>
      </li>
      <li>
        <p>The received response data is sent to the corresponding communicator.</p>
      </li>
      <li>
        <p>The communicator sends the response data to TAPI, which communicates it to the application.</p>
      </li>
    </ol>

    <p><strong>Figure: Response processing sequence</strong></p>

    <p><img src="media/telephony12.png" alt="Response processing sequence" /></p>
  </li>
  <li>Indication processing sequence
    <ol>
      <li>
        <p>The modem sends notification data to the physical HAL.</p>
      </li>
      <li>
        <p>The physical HAL dispatches the notification data to CMUX.</p>
      </li>
      <li>
        <p>CMUX decodes the received notification data and dispatches it to the corresponding logical HAL, based on the CMUX channel registered for the notification.</p>
      </li>
      <li>
        <p>The logical HAL dispatches the decoded notification data to the corresponding core object registered for the notification.</p>
      </li>
      <li>
        <p>The core object processes the received notification data and dispatches to the server.</p>
      </li>
      <li>
        <p>The server dispatches the notification data to the corresponding communicator.</p>
      </li>
      <li>
        <p>The communicator sends the notification data to TAPI, which communicates it to the application.</p>
      </li>
    </ol>

    <p><strong>Figure: Indication processing sequence</strong></p>

    <p><img src="media/telephony13.png" alt="Telephony13.png" /></p>
  </li>
</ul>

                        <button class="print-btn hidden-print" onclick="printDiv('printableArea')">PRINT</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer clearfix">
  <div class="copyright">
    © 2019 Tizen Project, a <a href="http://www.linuxfoundation.org/">Linux Foundation</a> Project. All Rights Reserved.
    Linux is a registered trademark of Linus Torvalds.<br>
    Tizen is a registered trademark of The Linux Foundation. * Other names and brands may be claimed as the property of
    others.<br>
    Except as noted, this content is licensed under Creative Commons Attribution 3.0. For details, see the <a
      href="https://www.tizen.org/content-license">Content License.</a><br>
  </div>
  <div class="family-sites">
    <a href="https://developer.tizen.org/">Developers</a>
    <div class="divider"></div>
    <a href="https://docs.tizen.org">Docs</a>
    <div class="divider"></div>
    <a href="https://dashboard.tizen.org">Dashboard</a>
    <div class="divider"></div>
    <a href="https://craftroom.tizen.org/">Craftroom</a>
  </div>
  <div class="outer-links">
    <div class="item">
      <a href="https://twitter.com/TizenProject"><img src="/images/ic_footer_twitter.png">Twitter</a>
    </div>
    <div class="item">
      <a href="http://www.facebook.com/pages/Tizen-Project/179577455452943?ref=ts"><img
          src="/images/ic_footer_facebook.png">Facebook</a>
    </div>
    <div class="item">
      <a href="https://bugs.tizen.org"><img src="/images/ic_footer_bug.png">Bug Tracker</a>
    </div>
    <div class="item">
      <a href="http://lists.tizen.org"><img src="/images/ic_footer_mailing.png">Mailing Lists</a>
    </div>
    <div class="item">
      <a href="http://www.tizenstore.com"><img src="/images/ic_footer_tizenstore.png">Tizen Store</a>
    </div>
  </div>
</div>
    </div>
    <script type="text/javascript" src="/vendor/jquery/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="/vendor/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/js/common.js?v=29092019"></script>
<script type="text/javascript" src="/js/handlebars-v4.0.11.js?v=29092019"></script>
<script type="text/javascript" src="/js/widgets-data.js?v=29092019"></script>
<script type="text/javascript" src="/js/widgets.js?v=29092019"></script>
<script type="text/javascript" src="/js/toc.js"></script>
    <div id="templates"></div>    
</body>

</html>